var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),KeyStore;!function(t){var e;!function(t){t.Connected="connected",t.Closed="closed",t.NotStarted="not_connected"}(e=t.ConnectionStatus||(t.ConnectionStatus={})),t.Status={ConStatus:e.NotStarted,LastError:""},t.TableName="LocalStore",t.openDb=function(){t.KeyStoreObj.createDb(t.TableName)}}(KeyStore||(KeyStore={}));var KeyStore;!function(t){t.init=function(){t.Status.ConStatus==t.ConnectionStatus.NotStarted&&(t.UtilityLogic.setDbType(),t.KeyStoreObj=new t.Business.MainLogic,t.KeyStoreObj.createDb(t.TableName))},t.get=function(e,n,o){if(void 0===o&&(o=null),t.Status.ConStatus==t.ConnectionStatus.Connected){var r={From:this.TableName,Where:{Key:e}};this.KeyStoreObj.get(r,n,o)}else if(t.Status.ConStatus==t.ConnectionStatus.NotStarted){i=this;setTimeout(function(){i.get(e,n,o)},50)}else if(t.Status.ConStatus==t.ConnectionStatus.Closed){var i=this;this.openDb(),setTimeout(function(){i.get(e,n,o)},50)}},t.set=function(e,n,o,r){if(void 0===o&&(o=null),void 0===r&&(r=null),t.Status.ConStatus==t.ConnectionStatus.Connected){var i={Key:e,Value:n};t.KeyStoreObj.set(this.TableName,i,o,r)}else if(t.Status.ConStatus==t.ConnectionStatus.NotStarted){s=this;setTimeout(function(){s.set(e,n,o,r)},50)}else if(t.Status.ConStatus==t.ConnectionStatus.Closed){var s=this;this.openDb(),setTimeout(function(){s.set(e,n,o,r)},50)}},t.remove=function(e,n,o){if(void 0===n&&(n=null),void 0===o&&(o=null),t.Status.ConStatus==t.ConnectionStatus.Connected){var r={From:this.TableName,Where:{Key:e}};this.KeyStoreObj.remove(r,n,o)}else if(t.Status.ConStatus==t.ConnectionStatus.NotStarted){i=this;setTimeout(function(){i.remove(e,n,o)},50)}else if(t.Status.ConStatus==t.ConnectionStatus.Closed){var i=this;this.openDb(),setTimeout(function(){i.remove(e,n,o)},50)}}}(KeyStore||(KeyStore={}));var KeyStore;!function(t){var e=function(){function t(){}return t.setDbType=function(){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!indexedDB)throw"Your browser doesnot support IndexedDb";window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange},t}();t.UtilityLogic=e}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(t){var e=function(){return function(){this.Results=null,this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorOccured=function(t){1==++this.ErrorCount&&null!=this.OnError&&this.OnError(t.target.error),console.error(t)}}}();t.BaseLogic=e}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(t){var e=function(e){function n(n,o,r){var i=e.call(this)||this;i.get=function(){var t=this;for(var e in this.Query.Where){!function(e,n){var o=t.ObjectStore.index(e).openCursor(IDBKeyRange.only(n));o.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)},o.onsuccess=function(e){var n=e.target.result;n&&(t.Results=n.value.Value)}}(e,this.Query.Where[e]);break}};var s=i;return i.Query=n,i.OnError=r,i.Transaction=t.DbConnection.transaction([n.From],"readonly"),i.ObjectStore=i.Transaction.objectStore(n.From),i.Transaction.oncomplete=function(t){null!=o&&o(s.Results)},i.get(),i}return __extends(n,e),n}(t.BaseLogic);t.GetLogic=e}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(e){var n=function(){return function(n,o){var r=window.indexedDB.open(n,1);r.onerror=function(t){console.error(t.target.error)},r.onsuccess=function(n){t.Status.ConStatus=t.ConnectionStatus.Connected,e.DbConnection=r.result,e.DbConnection.onclose=function(){t.Status.ConStatus=t.ConnectionStatus.Closed,t.Status.LastError="Connection Closed"},e.DbConnection.onversionchange=function(t){null===t.newVersion&&t.target.close()},e.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},e.DbConnection.onabort=function(e){t.Status.ConStatus=t.ConnectionStatus.Closed,t.Status.LastError="Connection aborted"}},r.onupgradeneeded=function(t){t.target.result.createObjectStore(o,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();e.InitDbLogic=n}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(t){var e=function(){return function(){this.set=function(e,n,o,r){new t.SetLogic(e,n,o,r)},this.remove=function(e,n,o){new t.RemoveLogic(e,n,o)},this.get=function(e,n,o){new t.GetLogic(e,n,o)},this.createDb=function(e){new t.InitDbLogic("KeyStore",e)}}}();t.MainLogic=e}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(t){var e=function(e){function n(n,o,r){var i=e.call(this)||this;i.RowAffected=0,i.remove=function(){var t=this;for(var e in this.Query.Where){t.ErrorOccured||function(e,n){var o=t.ObjectStore.index(e).openCursor(IDBKeyRange.only(n));o.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)},o.onsuccess=function(e){var n=e.target.result;n&&(n.delete(),++t.RowAffected,n.continue())}}(e,t.Query.Where[e]);break}};var s=i;return i.Query=n,i.OnError=r,i.Transaction=t.DbConnection.transaction([n.From],"readwrite"),i.ObjectStore=i.Transaction.objectStore(n.From),i.Transaction.oncomplete=function(){null!=o&&o(s.RowAffected)},i.Transaction.onerror=function(t){s.onErrorOccured(t)},i.remove(),i}return __extends(n,e),n}(t.BaseLogic);t.RemoveLogic=e}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(t){!function(t){var e=function(e){function n(n,o,r,i){var s=e.call(this)||this;s.setData=function(t){var e=this,n=function(){e.ObjectStore.add(t).onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}};!function(){var o=e.ObjectStore.index("Key").openCursor(IDBKeyRange.only(t.Key));o.onsuccess=function(e){var o=e.target.result;o?(o.value.Value=t.Value,o.update(o.value)):n()},o.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}()};try{s.OnError=i,s.Transaction=t.DbConnection.transaction([n],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n),s.Transaction.oncomplete=function(t){null!=r&&r()},s.setData(o)}catch(t){console.error(t)}return s}return __extends(n,e),n}(t.BaseLogic);t.SetLogic=e}(t.Business||(t.Business={}))}(KeyStore||(KeyStore={}));