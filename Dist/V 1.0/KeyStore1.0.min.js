var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),KeyStore;!function(e){!function(e){e[e.UndefinedColumn=0]="UndefinedColumn",e[e.UndefinedValue=1]="UndefinedValue",e[e.UndefinedColumnName=2]="UndefinedColumnName",e[e.UndefinedColumnValue=3]="UndefinedColumnValue",e[e.NotArray=4]="NotArray",e[e.NoValueSupplied=5]="NoValueSupplied",e[e.ColumnNotExist=6]="ColumnNotExist",e[e.InvalidOp=7]="InvalidOp",e[e.NullValue=8]="NullValue",e[e.BadDataType=9]="BadDataType",e[e.NextJoinNotExist=10]="NextJoinNotExist",e[e.TableNotExist=11]="TableNotExist"}(e.ErrorType||(e.ErrorType={}));var t;!function(e){e[e.Connected=1]="Connected",e[e.Closed=2]="Closed",e[e.NotStarted=3]="NotStarted"}(t=e.ConnectionStatus||(e.ConnectionStatus={})),e.Status={ConStatus:t.NotStarted,LastError:""}}(KeyStore||(KeyStore={}));var KeyStore;!function(e){var t=function(){function t(){}return t.getError=function(t,n,o){void 0===n&&(n=!1);var r={Name:e.ErrorType[t],Value:""};switch(t){case e.ErrorType.NotArray:r.Value="Supplied value is not an array";break;case e.ErrorType.UndefinedColumn:r.Value="Column is undefined in Where";break;case e.ErrorType.UndefinedValue:r.Value="Value is undefined in Where";break;case e.ErrorType.UndefinedColumnName:r.Value="Column name is undefined";break;case e.ErrorType.UndefinedColumnValue:r.Value="Column value is undefined";break;case e.ErrorType.NoValueSupplied:r.Value="No value supplied";break;case e.ErrorType.InvalidOp:r.Value="Invalid Op Value '"+o.Op+"'";break;case e.ErrorType.ColumnNotExist:r.Value="Column '"+o.ColumnName+"' does not exist";break;case e.ErrorType.NullValue:r.Value="Null value is not allowed for column '"+o.ColumnName+"'";break;case e.ErrorType.BadDataType:r.Value="Supplied value for column '"+o.ColumnName+"' does not have valid type";break;case e.ErrorType.NextJoinNotExist:r.Value="Next join details not supplied";break;case e.ErrorType.TableNotExist:r.Value="Table '"+o.TableName+"' does not exist";break;default:console.warn("the error type is not defined")}return n&&console.warn("JsStorage Error :- "+r.Value),r},t.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),n=t.length;n--;){var o=t[n];e[o.toLowerCase()]=e[o],delete e[o]}},t.setDbType=function(){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!indexedDB)throw"Your browser doesnot support IndexedDb";window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange},t}();e.UtilityLogic=t}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(e,t){if(null==e.Name)throw"Column Name is not defined for table:"+t;this.Name=e.Name,this.AutoIncrement=null!=e.AutoIncrement&&e.AutoIncrement,this.PrimaryKey=null!=e.PrimaryKey&&e.PrimaryKey,this.Unique=null!=e.Unique&&e.Unique,this.CurrentDate=null!=e.CurrentDate&&e.CurrentDate,this.NotNull=null!=e.NotNull&&e.NotNull,this.DataType=null!=e.DataType?e.DataType:""}}();e.Column=t}(e.Model||(e.Model={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){function t(t,n){this.Name="",this.Columns=[],this.RequireDelete=!1,this.RequireCreation=!1,this.PrimaryKey="",this.Name=t.Name,this.Version=void 0==t.Version?1:t.Version;var o=this;t.Columns.forEach(function(n){o.Columns.push(new e.Column(n,t.Name))}),this.setRequireDelete(n),this.setPrimaryKey()}return t.prototype.setPrimaryKey=function(){var e=this;this.Columns.length;this.Columns.forEach(function(t,n){t.PrimaryKey&&0==e.PrimaryKey.length&&(e.PrimaryKey=t.Name)})},t.prototype.setRequireDelete=function(e){this.RequireDelete=!0},t}();e.Table=t}(e.Model||(e.Model={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(t){this.Tables=[];var n=this;this.Name=t.Name,t.Tables.forEach(function(t){n.Tables.push(new e.Table(t,n.Name))})}}();e.DataBase=t}(e.Model||(e.Model={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){var n=function(){return function(){var n=window.indexedDB.open(t.ActiveDataBase.Name,t.DbVersion);n.onerror=function(e){console.error(e.target.error)},n.onsuccess=function(o){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=n.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection aborted"}},n.onupgradeneeded=function(e){var n=e.target.result;t.ActiveDataBase.Tables.forEach(function(e){e.RequireDelete?(n.objectStoreNames.contains(e.Name)&&n.deleteObjectStore(e.Name),o(n,e)):e.RequireCreation&&o(n,e)})};var o=function(e,t){try{if(t.PrimaryKey.length>0)n=e.createObjectStore(t.Name,{keyPath:t.PrimaryKey}),t.Columns.forEach(function(e){e.PrimaryKey?n.createIndex(e.Name,e.Name,{unique:!0}):n.createIndex(e.Name,e.Name,{unique:!1})});else{var n=e.createObjectStore(t.Name,{autoIncrement:!0});t.Columns.forEach(function(e){e.Unique?n.createIndex(e.Name,e.Name,{unique:!0}):n.createIndex(e.Name,e.Name,{unique:!1})})}}catch(e){console.error(e)}}}}();t.CreateDbLogic=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(t,n,o){var r=e.DbConnection.transaction([t.From],"readwrite"),i=r.objectStore(t.From),a=!1,u=0,s=0,c=function(e){++u,null!=o&&1==this.ErrorCount&&o(e.target.error),console.error(e)};r.oncomplete=function(){null!=n&&n(s)},r.onerror=c;var l;Object.keys(t.Where).length;for(l in t.Where){if(a)return;var d=i.index(l).openCursor(IDBKeyRange.only(t.Where[l]));d.onerror=function(e){a=!0,c(e)},d.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),++s,t.continue())}}}}();e.RemoveLogic=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(t,n,o,r,i){this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorRequest=function(e,t){void 0===t&&(t=!1),1==++this.ErrorCount&&null!=this.OnError&&(t?this.OnError(e,this.TotalRowsAffected):this.OnError(e.target.error,this.TotalRowsAffected)),console.error(e)};try{this.OnSuccess=r,this.OnError=i;var a=this,u=!1,s=function(){var o=e.DbConnection.transaction([t],"readwrite");a.Store=o.objectStore(t),o.oncomplete=function(e){null!=r&&r()},a.Store.add(n).onerror=function(e){a.onErrorRequest(e)}};!function(){var o=e.DbConnection.transaction([t],"readwrite");a.Store=o.objectStore(t),o.oncomplete=function(e){u?null!=r&&r():s()};var i=a.Store.index("Key").openCursor(IDBKeyRange.only(n.Key));i.onsuccess=function(e){var t=e.target.result;t&&(u=!0,t.value.Value=n.Value,t.update(t.value))},i.onerror=function(e){a.ErrorOccured=!0,a.onErrorRequest(e)}}()}catch(e){console.error(e)}}}();e.SetLogic=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){var n=function(){return function(n,o,r){if(e.Status.ConStatus!=e.ConnectionStatus.Connected)if(t.ActiveDataBase.Name.length>0){var i=window.indexedDB.open(t.ActiveDataBase.Name,t.DbVersion);i.onerror=function(e){null!=r&&r(e.target.error)},i.onsuccess=function(r){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=i.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed, trying to reconnect"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Aborted"},null!=o&&o(n)}}else null!=r&&r({Name:"DbNotFound",Value:"DataBase name is not found, please first initiate the db using createDb"});else null!=o&&o()}}();t.OpenDbLogic=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(){this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorRequest=function(e){1==++this.ErrorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.BaseGetLogic=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function n(n,o,r){var i=t.call(this)||this;i.executeWhereLogic=function(){var e,t=this;for(e in this.Query.Where){!function(e,n){var o=t.ObjectStore.index(e).openCursor(IDBKeyRange.only(n));o.onerror=function(e){t.ErrorOccured=!0,t.onErrorRequest(e)},o.onsuccess=function(e){var n=e.target.result;n&&(t.Results=n.value.Value)}}(e,this.Query.Where[e]);break}};var a=i;return i.Query=n,i.OnSuccess=o,i.OnError=r,i.Transaction=e.DbConnection.transaction([n.From],"readonly"),i.Transaction.oncomplete=function(e){null!=o&&o(a.Results)},i.ObjectStore=i.Transaction.objectStore(n.From),i.executeWhereLogic(),i}return __extends(n,t),n}(e.BaseGetLogic);e.GetLogic=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){t.DbVersion=1;var n=function(){return function(n){this.openDb=function(e,n,o){new t.OpenDbLogic(e,n,o)},this.closeDb=function(){e.Status.ConStatus==e.ConnectionStatus.Connected&&t.DbConnection.close()},this.set=function(e,n,o,r,i){new t.SetLogic(e,n,o,r,i)},this.remove=function(e,n,o){new t.RemoveLogic(e,n,o)},this.get=function(e,n,o){new t.GetLogic(e,n,o)},this.createDb=function(){new t.CreateDbLogic},t.ActiveDataBase=n}}();t.MainLogic=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var Model=KeyStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table,KeyStore;!function(e){var t=function(){function t(){if(this.TableName="LocalStore",e.Status.ConStatus==e.ConnectionStatus.NotStarted){e.UtilityLogic.setDbType();var t={Name:this.TableName,Columns:[{Name:"Key",PrimaryKey:!0}]},n=new DataBase({Name:"KeyStores",Tables:[t]});this.KeyStoreObj=new e.Business.MainLogic(n),this.KeyStoreObj.createDb()}}return t.prototype.openDb=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.KeyStoreObj.openDb(this,e,t)},t.prototype.closeDb=function(e,t){this.KeyStoreObj.closeDb()},t.prototype.get=function(t,n,o){if(void 0===o&&(o=null),e.Status.ConStatus==e.ConnectionStatus.Connected){var r={From:this.TableName,Where:{Key:t}};this.KeyStoreObj.get(r,n,o)}else if(e.Status.ConStatus==e.ConnectionStatus.NotStarted){i=this;setTimeout(function(){i.get(t,n,o)},50)}else if(e.Status.ConStatus==e.ConnectionStatus.Closed){var i=this;this.openDb(function(){i.get(t,n,o)})}},t.prototype.set=function(t,n,o,r){if(void 0===o&&(o=null),void 0===r&&(r=null),e.Status.ConStatus==e.ConnectionStatus.Connected){var i={Key:t,Value:n};this.KeyStoreObj.set(this.TableName,i,!1,o,r)}else if(e.Status.ConStatus==e.ConnectionStatus.NotStarted){a=this;setTimeout(function(){a.set(t,n,o,r)},50)}else if(e.Status.ConStatus==e.ConnectionStatus.Closed){var a=this;this.openDb(function(){a.set(t,n,o,r)})}},t.prototype.remove=function(t,n,o){if(void 0===n&&(n=null),void 0===o&&(o=null),e.Status.ConStatus==e.ConnectionStatus.Connected){var r={From:this.TableName,Where:{Key:t}};this.KeyStoreObj.remove(r,n,o)}else if(e.Status.ConStatus==e.ConnectionStatus.NotStarted){i=this;setTimeout(function(){i.remove(t,n,o)},50)}else if(e.Status.ConStatus==e.ConnectionStatus.Closed){var i=this;this.openDb(function(){i.remove(t,n,o)})}},t}();e.Instance=t}(KeyStore||(KeyStore={}));