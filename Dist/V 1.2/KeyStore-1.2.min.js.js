var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])};return function(n,t){function o(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),KeyStore;!function(e){!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_connected"}(e.ConnectionStatus||(e.ConnectionStatus={})),e.QueryRequests=[],e.TableName="LocalStore"}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.prcoessExecutionOfCode=function(n){e.QueryRequests.push(n),1==e.QueryRequests.length&&e.executeCode()},e.executeCode=function(){if(e.QueryRequests.length>0){e.QueryRequests[0].Name,e.QueryRequests[0].Query;e.executeCodeDirect(e.QueryRequests[0])}},e.executeCodeDirect=function(n){var t=this;new e.Business.Main(function(e){t.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(n)},e.processFinishedRequest=function(e){var n=this.QueryRequests.shift();e.ErrorOccured?n.OnError?n.OnError(e.ErrorDetails):console.log(e.ErrorDetails):n.OnSuccess&&(e.ReturnedValue?n.OnSuccess(e.ReturnedValue):n.OnSuccess()),this.executeCode()}}(KeyStore||(KeyStore={}));var KeyStore;!function(e){var n=function(){function e(){}return e.setDbType=function(){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!indexedDB)throw"Your browser doesnot support IndexedDb";window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange},e}();e.Utils=n}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var n=function(){return function(){this.Results=null,this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorOccured=function(e){1==++this.ErrorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.Base=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var n=function(n){function t(t,o,r){var c=n.call(this)||this;c.get=function(){var e=this;for(var n in this.Query.Where){!function(n,t){var o=e.ObjectStore.index(n).openCursor(IDBKeyRange.only(t));o.onerror=function(n){e.ErrorOccured=!0,e.onErrorOccured(n)},o.onsuccess=function(n){var t=n.target.result;t&&(e.Results=t.value.Value)}}(n,this.Query.Where[n]);break}};var s=c;return c.Query=t,c.OnError=r,c.Transaction=e.DbConnection.transaction([t.From],"readonly"),c.ObjectStore=c.Transaction.objectStore(t.From),c.Transaction.oncomplete=function(e){null!=o&&o(s.Results)},c.get(),c}return __extends(t,n),t}(e.Base);e.Get=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var n=function(n){function t(t,o,r){var c=n.call(this)||this;c.setData=function(e){var n=this,t=function(){n.ObjectStore.add(e).onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}};!function(){var o=n.ObjectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));o.onsuccess=function(n){var o=n.target.result;o?(o.value.Value=e.Value,o.update(o.value)):t()},o.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}}()};try{c.OnError=r,c.Transaction=e.DbConnection.transaction([t.TableName],"readwrite"),c.ObjectStore=c.Transaction.objectStore(t.TableName),c.Transaction.oncomplete=function(e){null!=o&&o()},c.setData(t.Set)}catch(e){console.error(e)}return c}return __extends(t,n),t}(e.Base);e.Set=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var n=function(n){function t(t,o,r){var c=n.call(this)||this;c.RowAffected=0,c.remove=function(){var e=this;for(var n in this.Query.Where){e.ErrorOccured||function(n,t){var o=e.ObjectStore.index(n).openCursor(IDBKeyRange.only(t));o.onerror=function(n){e.ErrorOccured=!0,e.onErrorOccured(n)},o.onsuccess=function(n){var t=n.target.result;t&&(t.delete(),++e.RowAffected,t.continue())}}(n,e.Query.Where[n]);break}};var s=c;return c.Query=t,c.OnError=r,c.Transaction=e.DbConnection.transaction([t.From],"readwrite"),c.ObjectStore=c.Transaction.objectStore(t.From),c.Transaction.oncomplete=function(){null!=o&&o(s.RowAffected)},c.Transaction.onerror=function(e){s.onErrorOccured(e)},c.remove(),c}return __extends(t,n),t}(e.Base);e.Remove=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(n){var t=function(){return function(t,o,r,c){var s=window.indexedDB.open(t,1);s.onerror=function(e){null!=c&&c(e.target.error)},s.onsuccess=function(t){n.Status.ConStatus=e.ConnectionStatus.Connected,n.DbConnection=s.result,n.DbConnection.onclose=function(){n.Status.ConStatus=e.ConnectionStatus.Closed,n.Status.LastError="Connection Closed"},n.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},n.DbConnection.onerror=function(e){n.Status.LastError="Error occured in connection :"+e.target.result},n.DbConnection.onabort=function(t){n.Status.ConStatus=e.ConnectionStatus.Closed,n.Status.LastError="Connection aborted"},null!=r&&r()},s.onupgradeneeded=function(e){e.target.result.createObjectStore(o,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();n.InitDb=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(n){n.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var t=function(){return function(t){void 0===t&&(t=null),this.checkConnectionAndExecuteLogic=function(t){if("create_db"==t.Name||"open_db"==t.Name)this.executeLogic(t);else if(n.Status.ConStatus==e.ConnectionStatus.Connected)this.executeLogic(t);else if(n.Status.ConStatus==e.ConnectionStatus.NotStarted)o=this,setTimeout(function(){o.checkConnectionAndExecuteLogic(t)},50);else if(n.Status.ConStatus==e.ConnectionStatus.Closed){var o=this;this.createDb(e.TableName),setTimeout(function(){o.checkConnectionAndExecuteLogic(t)},50)}},this.returnResult=function(e){this.OnSuccess?this.OnSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var n=this,t=function(e){n.returnResult({ReturnedValue:e})},o=function(e){n.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"get":this.get(e.Query,t,o);break;case"set":this.set(e.Query,t,o);break;case"remove":this.remove(e.Query,t,o);break;case"create_db":this.createDb(e.Query,t,o)}},this.set=function(e,t,o){new n.Set(e,t,o)},this.remove=function(e,t,o){new n.Remove(e,t,o)},this.get=function(e,t,o){new n.Get(e,t,o)},this.createDb=function(e,t,o){new n.InitDb("KeyStore",e,t,o)},this.OnSuccess=t}}();n.Main=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),e.prcoessExecutionOfCode({Name:"create_db"})},e.get=function(n,t,o){void 0===o&&(o=null);var r={From:this.TableName,Where:{Key:n}};e.prcoessExecutionOfCode({Name:"get",Query:r,OnSuccess:t,OnError:o})},e.set=function(n,t,o,r){void 0===o&&(o=null),void 0===r&&(r=null);var c={TableName:this.TableName,Set:{Key:n,Value:t}};e.prcoessExecutionOfCode({Name:"set",Query:c,OnSuccess:o,OnError:r})},e.remove=function(n,t,o){void 0===t&&(t=null),void 0===o&&(o=null);var r={From:this.TableName,Where:{Key:n}};e.prcoessExecutionOfCode({Name:"remove",Query:r,OnSuccess:t,OnError:o})}}(KeyStore||(KeyStore={})),KeyStore.init();